# Autonomous Cryptographic Residency Engine

A mastery-based, persona-driven, model-routed cryptography learning system.
Lessons are generated by AI professor personas, committed to GitHub, and tracked via a state machine.

---

## Architecture

```
apps/
  orchestrator/
    index.ts              ← CLI entry point: reads state, generates, commits

packages/
  core/
    types.ts              ← All shared TypeScript interfaces
    model-router.ts       ← Routes task types to LLM models
    professor-personas.ts ← Faculty definitions (Euclid, Turing, Goldwasser, Nakamoto)
    curriculum.ts         ← Ordered lesson registry
    state.ts              ← state.json read/write + state.md append
    lesson-generator.ts   ← Prompt construction + OpenAI calls for lesson content
    professor-engine.ts   ← Orchestrates persona loading + lesson generation
    grading-engine.ts     ← Evaluates submissions with professor grading bias
  llm/
    openai-client.ts      ← OpenAI wrapper with retries and error logging
  github/
    github-client.ts      ← GitHub REST API commit via PAT (no git CLI required)

residency/
  state.json              ← Machine-readable residency state
  state.md                ← Human-readable history log
```

---

## Prerequisites

- Node.js 20+
- npm (or pnpm)
- OpenAI API key
- GitHub Personal Access Token with `repo` scope
- A GitHub repository (must have at least one commit / `main` branch)

---

## Setup

### 1. Install dependencies

```bash
npm install
```

### 2. Configure environment

```bash
cp .env.example .env
```

Edit `.env`:

```env
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE
GITHUB_PAT=YOUR_GITHUB_PAT_HERE
GITHUB_OWNER=your-github-username
GITHUB_REPO=your-repo-name
```

> The GitHub repo must already exist and have a `main` branch with at least one commit.

---

## Running Day 001

```bash
npm run day:run
```

This will:

1. Read `residency/state.json`
2. Confirm status is `NOT_STARTED`
3. Activate **Professor Euclid** for Day 1: *Finite Fields — Modular Arithmetic*
4. Generate `lesson.md`, `homework.md`, `rubric.md` via GPT-4o
5. Commit all three files to `residency/day-001/` on your GitHub repo
6. Update `state.json` → `status: ASSIGNED`
7. Append a summary entry to `residency/state.md`
8. Print the commit URL

---

## Model Routing

| Task Type      | Model       |
|----------------|-------------|
| `lesson`       | gpt-4o      |
| `grading`      | gpt-4o      |
| `summary`      | gpt-4o-mini |
| `orchestration`| gpt-4o-mini |

> Model aliases are configured in `packages/core/model-router.ts`.
> Swap to `gpt-5.2` / `gpt-5-mini` once available via API.

---

## Professor Personas

| ID          | Name                  | Strictness | Focus                          |
|-------------|-----------------------|------------|--------------------------------|
| `euclid`    | Professor Euclid      | 9/10       | Formal proofs, number theory   |
| `turing`    | Professor Turing      | 8/10       | Implementation, edge cases     |
| `goldwasser`| Professor Goldwasser  | 9/10       | ZK proofs, security reductions |
| `nakamoto`  | Professor Nakamoto    | 10/10      | Threat modeling, adversarial   |

---

## Curriculum

| Day | Lesson ID | Topic                              | Default Professor |
|-----|-----------|------------------------------------|-------------------|
| 1   | FF-001    | Finite Fields — Modular Arithmetic | euclid            |
| 2   | FF-002    | Modular Inverses                   | euclid            |
| 3   | EC-001    | Elliptic Curve Point Addition      | goldwasser        |

---

## State Machine

```
NOT_STARTED → ASSIGNED → SUBMITTED → PASS  → (next lesson, NOT_STARTED)
                                   → FAIL  → (increment attempt, NOT_STARTED)
```

To manually reset for re-run:
```bash
# Edit residency/state.json
{ "status": "NOT_STARTED", "attempt": 1, ... }
```

---

## Next Milestones

- [ ] Telegram `/submit` command
- [ ] Real grading loop with rubric evaluation
- [ ] Mastery enforcement + automatic day advancement
- [ ] GPT-5.2 / GPT-5.2 Pro routing when available
- [ ] Capstone evaluation engine
